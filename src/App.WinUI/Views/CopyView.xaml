<Page
    x:Class="CopyOpsSuite.App.WinUI.Views.CopyView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:CopyOpsSuite.App.WinUI.Converters"
    xmlns:viewmodels="using:CopyOpsSuite.App.WinUI.ViewModels"
    x:DataType="viewmodels:CopyViewModel">

    <Page.Resources>
        <converters:HealthBrushConverter x:Key="HealthBrushConverter" />
        <converters:StateBrushConverter x:Key="StateBrushConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <SolidColorBrush x:Key="AccentBrush" Color="#2AD4D8" />
        <SolidColorBrush x:Key="CardBackgroundBrush" Color="#262626" />
        <SolidColorBrush x:Key="CardBorderBrush" Color="#333333" />
        <SolidColorBrush x:Key="RowBackgroundBrush" Color="#242424" />
        <SolidColorBrush x:Key="RowAltBackgroundBrush" Color="#1F1F1F" />
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource CardBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>
    </Page.Resources>

    <Page.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#1A1A1A" Offset="0" />
            <GradientStop Color="#222222" Offset="1" />
        </LinearGradientBrush>
    </Page.Background>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Style="{StaticResource CardStyle}">
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="2*" />
                </Grid.ColumnDefinitions>
                <StackPanel Spacing="10">
                    <TextBlock Text="Fuente" FontWeight="SemiBold" FontSize="16" />
                    <TextBox Text="{x:Bind SourcePath, Mode=TwoWay}" PlaceholderText="Ruta de carpeta" />
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Content="Examinar" Click="BrowseSource_Click" />
                        <Button Content="Iniciar copia" Command="{x:Bind StartCommand}" />
                        <Button Content="Simular" Click="Simulate_Click" />
                        <Button Content="Agregar archivos" Click="AddFiles_Click" IsEnabled="{x:Bind IsJobRunning}" />
                        <Button Content="Refrescar" Command="{x:Bind RefreshDevicesCommand}" />
                    </StackPanel>
                    <TextBlock Text="{x:Bind StatusMessage}" FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                    <TextBlock Text="{x:Bind RamStatus}" FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                </StackPanel>
                <StackPanel Grid.Column="1" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="Progreso general" FontWeight="SemiBold" />
                    <ProgressBar Value="{x:Bind OverallProgress}" Maximum="1" Height="12" Foreground="{StaticResource AccentBrush}" />
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="{x:Bind OverallProgressText}" FontWeight="SemiBold" />
                        <TextBlock Text="{x:Bind SelectionSummary}" FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="4*" />
                <ColumnDefinition Width="2.4*" />
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                <Grid RowSpacing="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Text="Destinos USB" FontWeight="SemiBold" FontSize="16" />
                    <controls:DataGrid Grid.Row="1"
                        ItemsSource="{x:Bind DeviceRows}"
                        AutoGenerateColumns="False"
                        HeadersVisibility="Column"
                        SelectionMode="None"
                        CanUserResizeColumns="True"
                        AlternationCount="2"
                        GridLinesVisibility="None"
                        RowHeight="64"
                        RowBackground="{StaticResource RowBackgroundBrush}"
                        AlternatingRowBackground="{StaticResource RowAltBackgroundBrush}">
                        <controls:DataGrid.Columns>
                            <controls:DataGridTemplateColumn Header="#" Width="38">
                                <controls:DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate x:DataType="viewmodels:DeviceRowViewModel">
                                        <CheckBox IsChecked="{x:Bind IsSelected, Mode=TwoWay}" HorizontalAlignment="Center" />
                                    </DataTemplate>
                                </controls:DataGridTemplateColumn.CellTemplate>
                            </controls:DataGridTemplateColumn>
                            <controls:DataGridTemplateColumn Header="Dispositivo" Width="220">
                                <controls:DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate x:DataType="viewmodels:DeviceRowViewModel">
                                        <StackPanel>
                                            <TextBlock Text="{x:Bind DriveLetter}" FontWeight="SemiBold" />
                                            <TextBlock Text="{x:Bind Label}" FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" TextWrapping="Wrap" />
                                            <Border Background="{StaticResource AccentBrush}" CornerRadius="6" Padding="4,2,4,2" Margin="0,4,0,0">
                                                <TextBlock Text="{x:Bind BusHint}" FontSize="10" FontWeight="SemiBold" />
                                            </Border>
                                        </StackPanel>
                                    </DataTemplate>
                                </controls:DataGridTemplateColumn.CellTemplate>
                            </controls:DataGridTemplateColumn>
                            <controls:DataGridTextColumn Header="Sistema" Binding="{x:Bind FileSystem}" Width="90" />
                            <controls:DataGridTemplateColumn Header="Progreso" Width="170">
                                <controls:DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate x:DataType="viewmodels:DeviceRowViewModel">
                                        <Grid ToolTipService.ToolTip="{x:Bind TooltipText}">
                                            <StackPanel>
                                                <ProgressBar Value="{x:Bind ProgressValue}" Maximum="1" Height="10" Foreground="{StaticResource AccentBrush}" />
                                                <TextBlock Text="{x:Bind ProgressText}" FontSize="10" HorizontalAlignment="Right" />
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </controls:DataGridTemplateColumn.CellTemplate>
                            </controls:DataGridTemplateColumn>
                            <controls:DataGridTemplateColumn Header="Velocidad" Width="140">
                                <controls:DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate x:DataType="viewmodels:DeviceRowViewModel">
                                        <StackPanel>
                                            <TextBlock Text="{x:Bind CurrentSpeedText}" FontSize="12" />
                                            <TextBlock Text="{x:Bind AverageSpeedText}" FontSize="10"
                                                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </controls:DataGridTemplateColumn.CellTemplate>
                            </controls:DataGridTemplateColumn>
                            <controls:DataGridTextColumn Header="Datos" Binding="{x:Bind DataText}" Width="140" />
                            <controls:DataGridTemplateColumn Header="Cobro en vivo" Width="170">
                                <controls:DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate x:DataType="viewmodels:DeviceRowViewModel">
                                        <StackPanel ToolTipService.ToolTip="{x:Bind ChargeTooltip}">
                                            <TextBlock Text="{x:Bind ChargeNowDisplay}" FontSize="12" />
                                            <TextBlock Text="{x:Bind ChargeFinalDisplay}" FontSize="12" />
                                        </StackPanel>
                                    </DataTemplate>
                                </controls:DataGridTemplateColumn.CellTemplate>
                            </controls:DataGridTemplateColumn>
                        </controls:DataGrid.Columns>
                    </controls:DataGrid>
                </Grid>
            </Border>

            <StackPanel Grid.Column="1" Spacing="12">
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="6">
                        <TextBlock Text="Resumen rapido" FontWeight="SemiBold" FontSize="16" />
                        <TextBlock Text="Cobro total del job" FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                        <TextBlock Text="{x:Bind GlobalExpectedNowDisplay}" FontSize="20" FontWeight="SemiBold" />
                        <TextBlock Text="{x:Bind GlobalExpectedFinalDisplay}" FontSize="16" />
                        <muxc:NumberBox Header="Pagado" Value="{x:Bind PaidAmount, Mode=TwoWay}" Minimum="0" />
                        <ComboBox Header="Metodo" SelectedItem="{x:Bind PaymentMethod, Mode=TwoWay}">
                            <x:String>Efectivo</x:String>
                            <x:String>Tarjeta</x:String>
                            <x:String>Transferencia</x:String>
                        </ComboBox>
                        <TextBlock Text="{x:Bind PaymentStatus}" FontWeight="SemiBold" />
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Logs recientes" FontWeight="SemiBold" FontSize="16" />
                        <ListView ItemsSource="{x:Bind Logs}" MaxHeight="220">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:LogLineViewModel">
                                    <StackPanel>
                                        <TextBlock Text="{x:Bind Timestamp, StringFormat='[{0:HH:mm:ss}]'}" FontSize="11" Foreground="{ThemeResource SystemControlForegroundBaseLowBrush}" />
                                        <TextBlock Text="{x:Bind Message}" TextWrapping="Wrap" FontSize="12" />
                                        <TextBlock Text="{x:Bind Severity}" FontSize="10" Foreground="{ThemeResource SystemControlForegroundBaseLowBrush}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Eventos criticos" FontWeight="SemiBold" FontSize="16" />
                        <TextBlock Text="Los eventos de auditoria aparecen en la pestana Audit." TextWrapping="Wrap" FontSize="12" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
